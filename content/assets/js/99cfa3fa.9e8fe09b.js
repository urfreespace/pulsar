"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[12510],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=i,v=p["".concat(o,".").concat(m)]||p[m]||d[m]||s;return n?r.createElement(v,a(a({ref:t},c),{},{components:n})):r.createElement(v,a({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,a=new Array(s);a[0]=p;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var u=2;u<s;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},58215:function(e,t,n){var r=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,i=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:i},t)}},26396:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(87462),i=n(67294),s=n(72389),a=n(79443);var l=function(){var e=(0,i.useContext)(a.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},o=n(89521),u=n(86010),c="tabItem_vU9c";function d(e){var t,n,r,s=e.lazy,a=e.block,d=e.defaultValue,p=e.values,m=e.groupId,v=e.className,h=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=p?p:h.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),b=(0,o.lx)(f,(function(e,t){return e.value===t.value}));if(b.length>0)throw new Error('Docusaurus error: Duplicate values "'+b.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var k=null===d?d:null!=(t=null!=d?d:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=h[0])?void 0:r.props.value;if(null!==k&&!f.some((function(e){return e.value===k})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var y=l(),g=y.tabGroupChoices,w=y.setTabGroupChoices,x=(0,i.useState)(k),N=x[0],C=x[1],O=[],P=(0,o.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var T=g[m];null!=T&&T!==N&&f.some((function(e){return e.value===T}))&&C(T)}var E=function(e){var t=e.currentTarget,n=O.indexOf(t),r=f[n].value;r!==N&&(P(t),C(r),null!=m&&w(m,r))},L=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=O.indexOf(e.currentTarget)+1;n=O[r]||O[0];break;case"ArrowLeft":var i=O.indexOf(e.currentTarget)-1;n=O[i]||O[O.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:"tabs-container"},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":a},v)},f.map((function(e){var t=e.value,n=e.label;return i.createElement("li",{role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,className:(0,u.Z)("tabs__item",c,{"tabs__item--active":N===t}),key:t,ref:function(e){return O.push(e)},onKeyDown:L,onFocus:E,onClick:E},null!=n?n:t)}))),s?(0,i.cloneElement)(h.filter((function(e){return e.props.value===N}))[0],{className:"margin-vert--md"}):i.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==N})}))))}function p(e){var t=(0,s.Z)();return i.createElement(d,(0,r.Z)({key:String(t)},e))}},79443:function(e,t,n){var r=(0,n(67294).createContext)(void 0);t.Z=r},61390:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return u},toc:function(){return c},default:function(){return p}});var r=n(87462),i=n(63366),s=(n(67294),n(3905)),a=(n(26396),n(58215),["components"]),l={id:"concepts-multiple-advertised-listeners",title:"Multiple advertised listeners",sidebar_label:"Multiple advertised listeners",original_id:"concepts-multiple-advertised-listeners"},o=void 0,u={unversionedId:"concepts-multiple-advertised-listeners",id:"version-2.7.0/concepts-multiple-advertised-listeners",isDocsHomePage:!1,title:"Multiple advertised listeners",description:"When a Pulsar cluster is deployed in the production environment, it may require to expose multiple advertised addresses for the broker. For example, when you deploy a Pulsar cluster in Kubernetes and want other clients, which are not in the same Kubernetes cluster, to connect to the Pulsar cluster, you need to assign a broker URL to external clients. But clients in the same Kubernetes cluster can still connect to the Pulsar cluster through the internal network of Kubernetes.",source:"@site/versioned_docs/version-2.7.0/concepts-multiple-advertised-listeners.md",sourceDirName:".",slug:"/concepts-multiple-advertised-listeners",permalink:"/docs/2.7.0/concepts-multiple-advertised-listeners",editUrl:"https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.7.0/concepts-multiple-advertised-listeners.md",tags:[],version:"2.7.0",frontMatter:{id:"concepts-multiple-advertised-listeners",title:"Multiple advertised listeners",sidebar_label:"Multiple advertised listeners",original_id:"concepts-multiple-advertised-listeners"},sidebar:"version-2.7.0/docsSidebar",previous:{title:"Proxy support with SNI routing",permalink:"/docs/2.7.0/concepts-proxy-sni-routing"},next:{title:"Get started",permalink:"/docs/2.7.0/schema-get-started"}},c=[{value:"Advertised listeners",id:"advertised-listeners",children:[],level:2},{value:"Use multiple advertised listeners",id:"use-multiple-advertised-listeners",children:[],level:2}],d={toc:c};function p(e){var t=e.components,n=(0,i.Z)(e,a);return(0,s.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"When a Pulsar cluster is deployed in the production environment, it may require to expose multiple advertised addresses for the broker. For example, when you deploy a Pulsar cluster in Kubernetes and want other clients, which are not in the same Kubernetes cluster, to connect to the Pulsar cluster, you need to assign a broker URL to external clients. But clients in the same Kubernetes cluster can still connect to the Pulsar cluster through the internal network of Kubernetes."),(0,s.kt)("h2",{id:"advertised-listeners"},"Advertised listeners"),(0,s.kt)("p",null,"To ensure clients in both internal and external networks can connect to a Pulsar cluster, Pulsar introduces ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"internalListenerName")," configuration options into the ",(0,s.kt)("a",{parentName:"p",href:"/docs/2.7.0/reference-configuration#broker"},"broker configuration file")," to ensure that the broker supports exposing multiple advertised listeners and support the separation of internal and external network traffic."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"The ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners")," is used to specify multiple advertised listeners. The broker uses the listener as the broker identifier in the load manager and the bundle owner data. The ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners")," is formatted as ",(0,s.kt)("inlineCode",{parentName:"p"},"<listener_name>:pulsar://<host>:<port>, <listener_name>:pulsar+ssl://<host>:<port>"),". You can set up the ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners")," like\n",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners=internal:pulsar://192.168.1.11:6660,internal:pulsar+ssl://192.168.1.11:6651"),".")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"The ",(0,s.kt)("inlineCode",{parentName:"p"},"internalListenerName")," is used to specify the internal service URL that the broker uses. You can specify the ",(0,s.kt)("inlineCode",{parentName:"p"},"internalListenerName")," by choosing one of the ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners"),". The broker uses the listener name of the first advertised listener as the ",(0,s.kt)("inlineCode",{parentName:"p"},"internalListenerName")," if the ",(0,s.kt)("inlineCode",{parentName:"p"},"internalListenerName")," is absent."))),(0,s.kt)("p",null,"After setting up the ",(0,s.kt)("inlineCode",{parentName:"p"},"advertisedListeners"),", clients can choose one of the listeners as the service URL to create a connection to the broker as long as the network is accessible. However, if the client creates producers or consumer on a topic, the client must send a lookup requests to the broker for getting the owner broker, then connect to the owner broker to publish messages or consume messages. Therefore, You must allow the client to get the corresponding service URL with the same advertised listener name as the one used by the client. This helps keep client-side simple and secure."),(0,s.kt)("h2",{id:"use-multiple-advertised-listeners"},"Use multiple advertised listeners"),(0,s.kt)("p",null,"This example shows how a Pulsar client uses multiple advertised listeners."),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Configure multiple advertised listeners in the broker configuration file.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"\nadvertisedListeners={listenerName}:pulsar://xxxx:6650,\n{listenerName}:pulsar+ssl://xxxx:6651\n\n")),(0,s.kt)("ol",{start:2},(0,s.kt)("li",{parentName:"ol"},"Specify the listener name for the client.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n    .serviceUrl("pulsar://xxxx:6650")\n    .listenerName("external")\n    .build();\n\n')))}p.isMDXComponent=!0}}]);