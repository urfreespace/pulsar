"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[43714],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,h=m["".concat(o,".").concat(d)]||m[d]||u[d]||i;return a?n.createElement(h,s(s({ref:t},c),{},{components:a})):n.createElement(h,s({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},69834:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),s=["components"],l={id:"client-libraries-java",title:"The Pulsar Java client",sidebar_label:"Java",original_id:"client-libraries-java"},o=void 0,p={unversionedId:"client-libraries-java",id:"version-2.4.1/client-libraries-java",isDocsHomePage:!1,title:"The Pulsar Java client",description:"The Pulsar Java client can be used both to create Java producers, consumers, and readers of messages and to perform administrative tasks. The current version of the Java client is 2.4.1.",source:"@site/versioned_docs/version-2.4.1/client-libraries-java.md",sourceDirName:".",slug:"/client-libraries-java",permalink:"/docs/2.4.1/client-libraries-java",editUrl:"https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.4.1/client-libraries-java.md",tags:[],version:"2.4.1",frontMatter:{id:"client-libraries-java",title:"The Pulsar Java client",sidebar_label:"Java",original_id:"client-libraries-java"},sidebar:"version-2.4.1/docsSidebar",previous:{title:"Extending",permalink:"/docs/2.4.1/security-extending"},next:{title:"Go",permalink:"/docs/2.4.1/client-libraries-go"}},c=[{value:"Installation",id:"installation",children:[{value:"Maven",id:"maven",children:[],level:3},{value:"Gradle",id:"gradle",children:[],level:3}],level:2},{value:"Connection URLs",id:"connection-urls",children:[],level:2},{value:"Client configuration",id:"client-configuration",children:[],level:2},{value:"Producers",id:"producers",children:[{value:"Configuring producers",id:"configuring-producers",children:[],level:3},{value:"Message routing",id:"message-routing",children:[],level:3},{value:"Async send",id:"async-send",children:[],level:3},{value:"Configuring messages",id:"configuring-messages",children:[],level:3}],level:2},{value:"Consumers",id:"consumers",children:[{value:"Configuring consumers",id:"configuring-consumers",children:[],level:3},{value:"Async receive",id:"async-receive",children:[],level:3},{value:"Multi-topic subscriptions",id:"multi-topic-subscriptions",children:[],level:3},{value:"Subscription types",id:"subscription-types",children:[{value:"Exclusive",id:"exclusive",children:[],level:4},{value:"Failover",id:"failover",children:[],level:4},{value:"Shared",id:"shared",children:[],level:4},{value:"Key_Shared",id:"key_shared",children:[],level:4}],level:3}],level:2},{value:"Reader interface",id:"reader-interface",children:[],level:2},{value:"Schemas",id:"schemas",children:[{value:"Schema example",id:"schema-example",children:[],level:3}],level:2},{value:"Authentication",id:"authentication",children:[{value:"TLS Authentication",id:"tls-authentication",children:[],level:3},{value:"Athenz",id:"athenz",children:[],level:3}],level:2}],u={toc:c};function m(e){var t=e.components,a=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Pulsar Java client can be used both to create Java producers, consumers, and ",(0,i.kt)("a",{parentName:"p",href:"#reader-interface"},"readers")," of messages and to perform ",(0,i.kt)("a",{parentName:"p",href:"admin-api-overview"},"administrative tasks"),". The current version of the Java client is ",(0,i.kt)("strong",{parentName:"p"},"2.4.1"),"."),(0,i.kt)("p",null,"Javadoc for the Pulsar client is divided up into two domains, by package:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Package"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Maven Artifact"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"/api/client/2.4.1"},(0,i.kt)("inlineCode",{parentName:"a"},"org.apache.pulsar.client.api"))),(0,i.kt)("td",{parentName:"tr",align:"left"},"The producer and consumer API"),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client%7C2.4.1%7Cjar"},"org.apache.pulsar:pulsar-client:2.4.1"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"/api/admin/2.4.1"},(0,i.kt)("inlineCode",{parentName:"a"},"org.apache.pulsar.client.admin"))),(0,i.kt)("td",{parentName:"tr",align:"left"},"The Java ",(0,i.kt)("a",{parentName:"td",href:"admin-api-overview"},"admin API")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client-admin%7C2.4.1%7Cjar"},"org.apache.pulsar:pulsar-client-admin:2.4.1"))))),(0,i.kt)("p",null,"This document will focus only on the client API for producing and consuming messages on Pulsar topics. For a guide to using the Java admin client, see ",(0,i.kt)("a",{parentName:"p",href:"admin-api-overview"},"The Pulsar admin interface"),"."),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("p",null,"The latest version of the Pulsar Java client library is available via ",(0,i.kt)("a",{parentName:"p",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client%7C2.4.1%7Cjar"},"Maven Central"),". To use the latest version, add the ",(0,i.kt)("inlineCode",{parentName:"p"},"pulsar-client")," library to your build configuration."),(0,i.kt)("h3",{id:"maven"},"Maven"),(0,i.kt)("p",null,"If you're using Maven, add this to your ",(0,i.kt)("inlineCode",{parentName:"p"},"pom.xml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"\n\x3c!-- in your <properties> block --\x3e\n<pulsar.version>2.4.1</pulsar.version>\n\n\x3c!-- in your <dependencies> block --\x3e\n<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>pulsar-client</artifactId>\n  <version>${pulsar.version}</version>\n</dependency>\n\n")),(0,i.kt)("h3",{id:"gradle"},"Gradle"),(0,i.kt)("p",null,"If you're using Gradle, add this to your ",(0,i.kt)("inlineCode",{parentName:"p"},"build.gradle")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"\ndef pulsarVersion = '2.4.1'\n\ndependencies {\n    compile group: 'org.apache.pulsar', name: 'pulsar-client', version: pulsarVersion\n}\n\n")),(0,i.kt)("h2",{id:"connection-urls"},"Connection URLs"),(0,i.kt)("p",null,"To connect to Pulsar using client libraries, you need to specify a ",(0,i.kt)("a",{parentName:"p",href:"developing-binary-protocol"},"Pulsar protocol")," URL."),(0,i.kt)("p",null,"Pulsar protocol URLs are assigned to specific clusters, use the ",(0,i.kt)("inlineCode",{parentName:"p"},"pulsar")," scheme and have a default port of 6650. Here's an example for ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http"},"\npulsar://localhost:6650\n\n")),(0,i.kt)("p",null,"If you have more than one broker, the URL may look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http"},"\npulsar://localhost:6550,localhost:6651,localhost:6652\n\n")),(0,i.kt)("p",null,"A URL for a production Pulsar cluster may look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http"},"\npulsar://pulsar.us-west.example.com:6650\n\n")),(0,i.kt)("p",null,"If you're using ",(0,i.kt)("a",{parentName:"p",href:"security-tls-authentication"},"TLS")," authentication, the URL will look like something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http"},"\npulsar+ssl://pulsar.us-west.example.com:6651\n\n")),(0,i.kt)("h2",{id:"client-configuration"},"Client configuration"),(0,i.kt)("p",null,"You can instantiate a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object using just a URL for the target Pulsar ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#cluster"},"cluster"),", like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar://localhost:6650")\n        .build();\n\n')),(0,i.kt)("p",null,"If you have multiple brokers, you can initiate a PulsarClient like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar://localhost:6650,localhost:6651,localhost:6652")\n        .build();\n\n')),(0,i.kt)("blockquote",null,(0,i.kt)("h4",{parentName:"blockquote",id:"default-broker-urls-for-standalone-clusters"},"Default broker URLs for standalone clusters"),(0,i.kt)("p",{parentName:"blockquote"},"If you're running a cluster in ",(0,i.kt)("a",{parentName:"p",href:"getting-started-standalone"},"standalone mode"),", the broker will be available at the ",(0,i.kt)("inlineCode",{parentName:"p"},"pulsar://localhost:6650")," URL by default.")),(0,i.kt)("p",null,"If you create a client, you may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"loadConf")," configuration. Below are the available parameters used in ",(0,i.kt)("inlineCode",{parentName:"p"},"loadConf"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"serviceUrl")),(0,i.kt)("td",{parentName:"tr",align:null},"Service URL provider for Pulsar service"),(0,i.kt)("td",{parentName:"tr",align:null},"None")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"authPluginClassName")),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the authentication plugin"),(0,i.kt)("td",{parentName:"tr",align:null},"None")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"authParams")),(0,i.kt)("td",{parentName:"tr",align:null},"String represents parameters for the authentication plugin ",(0,i.kt)("br",null),(0,i.kt)("strong",{parentName:"td"},"Example"),(0,i.kt)("br",null)," key1:val1,key2:val2"),(0,i.kt)("td",{parentName:"tr",align:null},"None")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"long"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"operationTimeoutMs")),(0,i.kt)("td",{parentName:"tr",align:null},"Operation timeout"),(0,i.kt)("td",{parentName:"tr",align:null},"30000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"long"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"statsIntervalSeconds")),(0,i.kt)("td",{parentName:"tr",align:null},"Interval between each stat info",(0,i.kt)("br",null),"Stats is activated with positive ",(0,i.kt)("inlineCode",{parentName:"td"},"statsInterval"),(0,i.kt)("br",null),(0,i.kt)("inlineCode",{parentName:"td"},"statsIntervalSeconds")," should be set to 1 second at least"),(0,i.kt)("td",{parentName:"tr",align:null},"60")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"numIoThreads")),(0,i.kt)("td",{parentName:"tr",align:null},"Number of threads used for handling connections to brokers"),(0,i.kt)("td",{parentName:"tr",align:null},"1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"numListenerThreads")),(0,i.kt)("td",{parentName:"tr",align:null},"Number of threads used for handling message listeners"),(0,i.kt)("td",{parentName:"tr",align:null},"1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"useTcpNoDelay")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to use TCP no-delay flag on the connection to disable Nagle algorithm"),(0,i.kt)("td",{parentName:"tr",align:null},"true")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"useTls")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to use TLS encryption on the connection"),(0,i.kt)("td",{parentName:"tr",align:null},"false")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"tlsTrustCertsFilePath")),(0,i.kt)("td",{parentName:"tr",align:null},"Path to the trusted TLS certificate file"),(0,i.kt)("td",{parentName:"tr",align:null},"None")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"tlsAllowInsecureConnection")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether the Pulsar client accepts untrusted TLS certificate from broker"),(0,i.kt)("td",{parentName:"tr",align:null},"false")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"boolean"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"tlsHostnameVerificationEnable")),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to enable TLS hostname verification"),(0,i.kt)("td",{parentName:"tr",align:null},"false")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"concurrentLookupRequest")),(0,i.kt)("td",{parentName:"tr",align:null},"Number of concurrent lookup requests allowed to send on each broker connection to prevent overload on broker"),(0,i.kt)("td",{parentName:"tr",align:null},"5000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"maxLookupRequest")),(0,i.kt)("td",{parentName:"tr",align:null},"Maximum number of lookup requests allowed on each broker connection to prevent overload on broker"),(0,i.kt)("td",{parentName:"tr",align:null},"50000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"maxNumberOfRejectedRequestPerConnection")),(0,i.kt)("td",{parentName:"tr",align:null},"Maximum number of rejected requests of a broker in a certain time frame (30 seconds) after the current connection is closed and the client creates a new connection to connect to a different broker"),(0,i.kt)("td",{parentName:"tr",align:null},"50")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"keepAliveIntervalSeconds")),(0,i.kt)("td",{parentName:"tr",align:null},"Seconds of keeping alive interval for each client broker connection"),(0,i.kt)("td",{parentName:"tr",align:null},"30")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"connectionTimeoutMs")),(0,i.kt)("td",{parentName:"tr",align:null},"Duration of waiting for a connection to a broker to be established ",(0,i.kt)("br",null),"If the duration passes without a response from a broker, the connection attempt is dropped"),(0,i.kt)("td",{parentName:"tr",align:null},"10000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"requestTimeoutMs")),(0,i.kt)("td",{parentName:"tr",align:null},"Maximum duration for completing a request"),(0,i.kt)("td",{parentName:"tr",align:null},"60000")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"defaultBackoffIntervalNanos")),(0,i.kt)("td",{parentName:"tr",align:null},"Default duration for a backoff interval"),(0,i.kt)("td",{parentName:"tr",align:null},"TimeUnit.MILLISECONDS.toNanos(100);")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"long"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"maxBackoffIntervalNanos")),(0,i.kt)("td",{parentName:"tr",align:null},"Maximum duration for a backoff interval"),(0,i.kt)("td",{parentName:"tr",align:null},"TimeUnit.SECONDS.toNanos(30)")))),(0,i.kt)("p",null,"Check out the Javadoc for the ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," class for a full listing of configurable parameters."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"In addition to client-level configuration, you can also apply ",(0,i.kt)("a",{parentName:"p",href:"#configuring-producers"},"producer")," and ",(0,i.kt)("a",{parentName:"p",href:"#configuring-consumers"},"consumer")," specific configuration, as you'll see in the sections below.")),(0,i.kt)("h2",{id:"producers"},"Producers"),(0,i.kt)("p",null,"In Pulsar, producers write messages to topics. Once you've instantiated a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object (as in the section ",(0,i.kt)("a",{parentName:"p",href:"#client-configuration"},"above"),"), you can create a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/Producer"},"Producer")," for a specific Pulsar ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#topic"},"topic"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> producer = client.newProducer()\n        .topic("my-topic")\n        .create();\n\n// You can then send messages to the broker and topic you specified:\nproducer.send("My message".getBytes());\n\n')),(0,i.kt)("p",null,"By default, producers produce messages that consist of byte arrays. You can produce different types, however, by specifying a message ",(0,i.kt)("a",{parentName:"p",href:"#schemas"},"schema"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> stringProducer = client.newProducer(Schema.STRING)\n        .topic("my-topic")\n        .create();\nstringProducer.send("My message");\n\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"You should always make sure to close your producers, consumers, and clients when they are no longer needed:")),(0,i.kt)("blockquote",null,(0,i.kt)("pre",{parentName:"blockquote"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},"\nproducer.close();\nconsumer.close();\nclient.close();\n\n\n"))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Close operations can also be asynchronous:")),(0,i.kt)("blockquote",null,(0,i.kt)("pre",{parentName:"blockquote"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nproducer.closeAsync()\n   .thenRun(() -> System.out.println("Producer closed"));\n   .exceptionally((ex) -> {\n       System.err.println("Failed to close producer: " + ex);\n       return ex;\n   });\n\n\n'))),(0,i.kt)("h3",{id:"configuring-producers"},"Configuring producers"),(0,i.kt)("p",null,"If you instantiate a ",(0,i.kt)("inlineCode",{parentName:"p"},"Producer")," object specifying only a topic name, as in the example above, the producer will use the default configuration. To use a non-default configuration, there's a variety of configurable parameters that you can set. "),(0,i.kt)("p",null,"For a full listing, see the Javadoc for the ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/ProducerBuilder"},"ProducerBuilder")," class. Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> producer = client.newProducer()\n    .topic("my-topic")\n    .batchingMaxPublishDelay(10, TimeUnit.MILLISECONDS)\n    .sendTimeout(10, TimeUnit.SECONDS)\n    .blockIfQueueFull(true)\n    .create();\n\n')),(0,i.kt)("h3",{id:"message-routing"},"Message routing"),(0,i.kt)("p",null,"When using partitioned topics, you can specify the routing mode whenever you publish messages using a producer. For more on specifying a routing mode using the Java client, see the ",(0,i.kt)("a",{parentName:"p",href:"cookbooks-partitioned"},"Partitioned Topics")," cookbook."),(0,i.kt)("h3",{id:"async-send"},"Async send"),(0,i.kt)("p",null,"You can also publish messages ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/concepts-messaging#send-modes"},"asynchronously")," using the Java client. With async send, the producer will put the message in a blocking queue and return immediately. The client library will then send the message to the broker in the background. If the queue is full (max size configurable), the producer could be blocked or fail immediately when calling the API, depending on arguments passed to the producer."),(0,i.kt)("p",null,"Here's an example async send operation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nproducer.sendAsync("my-async-message".getBytes()).thenAccept(msgId -> {\n    System.out.printf("Message with ID %s successfully sent", msgId);\n});\n\n')),(0,i.kt)("p",null,"As you can see from the example above, async send operations return a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/MessageId"},"MessageId")," wrapped in a ",(0,i.kt)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,i.kt)("inlineCode",{parentName:"a"},"CompletableFuture")),"."),(0,i.kt)("h3",{id:"configuring-messages"},"Configuring messages"),(0,i.kt)("p",null,"In addition to a value, it's possible to set additional items on a given message:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nproducer.newMessage()\n    .key("my-message-key")\n    .value("my-async-message".getBytes())\n    .property("my-key", "my-value")\n    .property("my-other-key", "my-other-value")\n    .send();\n\n')),(0,i.kt)("p",null,"As for the previous case, it's also possible to terminate the builder chain with ",(0,i.kt)("inlineCode",{parentName:"p"},"sendAsync()")," and\nget a future returned."),(0,i.kt)("h2",{id:"consumers"},"Consumers"),(0,i.kt)("p",null,"In Pulsar, consumers subscribe to topics and handle messages that producers publish to those topics. You can instantiate a new ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#consumer"},"consumer")," by first instantiating a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object and passing it a URL for a Pulsar broker (as ",(0,i.kt)("a",{parentName:"p",href:"#client-configuration"},"above"),")."),(0,i.kt)("p",null,"Once you've instantiated a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object, you can create a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/Consumer"},"Consumer")," by specifying a ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#topic"},"topic")," and a ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/concepts-messaging#subscription-modes"},"subscription"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscribe();\n\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"subscribe")," method will automatically subscribe the consumer to the specified topic and subscription. One way to make the consumer listen on the topic is to set up a ",(0,i.kt)("inlineCode",{parentName:"p"},"while")," loop. In this example loop, the consumer listens for messages, prints the contents of any message that's received, and then ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#acknowledgment-ack"},"acknowledges")," that the message has been processed. If the processing logic fails, we use ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#acknowledgment-ack"},"negative acknowledgement"),"\nto have the message redelivered at a later point in time."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nwhile (true) {\n  // Wait for a message\n  Message msg = consumer.receive();\n\n  try {\n      // Do something with the message\n      System.out.printf("Message received: %s", new String(msg.getData()));\n\n      // Acknowledge the message so that it can be deleted by the message broker\n      consumer.acknowledge(msg);\n  } catch (Exception e) {\n      // Message failed to process, redeliver later\n      consumer.negativeAcknowledge(msg);\n  }\n}\n\n')),(0,i.kt)("h3",{id:"configuring-consumers"},"Configuring consumers"),(0,i.kt)("p",null,"If you instantiate a ",(0,i.kt)("inlineCode",{parentName:"p"},"Consumer")," object specifying only a topic and subscription name, as in the example above, the consumer will use the default configuration. To use a non-default configuration, there's a variety of configurable parameters that you can set. For a full listing, see the Javadoc for the ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/ConsumerBuilder"},"ConsumerBuilder")," class. Here's an example:"),(0,i.kt)("p",null,"Here's an example configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .ackTimeout(10, TimeUnit.SECONDS)\n        .subscriptionType(SubscriptionType.Exclusive)\n        .subscribe();\n\n')),(0,i.kt)("h3",{id:"async-receive"},"Async receive"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"receive")," method will receive messages synchronously (the consumer process will be blocked until a message is available). You can also use ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/concepts-messaging#receive-modes"},"async receive"),", which will return immediately with a ",(0,i.kt)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,i.kt)("inlineCode",{parentName:"a"},"CompletableFuture"))," object that completes once a new message is available."),(0,i.kt)("p",null,"Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"\nCompletableFuture<Message> asyncMessage = consumer.receiveAsync();\n\n")),(0,i.kt)("p",null,"Async receive operations return a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/Message"},"Message")," wrapped inside of a ",(0,i.kt)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,i.kt)("inlineCode",{parentName:"a"},"CompletableFuture")),"."),(0,i.kt)("h3",{id:"multi-topic-subscriptions"},"Multi-topic subscriptions"),(0,i.kt)("p",null,"In addition to subscribing a consumer to a single Pulsar topic, you can also subscribe to multiple topics simultaneously using ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/concepts-messaging#multi-topic-subscriptions"},"multi-topic subscriptions"),". To use multi-topic subscriptions you can supply either a regular expression (regex) or a ",(0,i.kt)("inlineCode",{parentName:"p"},"List")," of topics. If you select topics via regex, all topics must be within the same Pulsar namespace."),(0,i.kt)("p",null,"Here are some examples:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nimport org.apache.pulsar.client.api.Consumer;\nimport org.apache.pulsar.client.api.PulsarClient;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nConsumerBuilder consumerBuilder = pulsarClient.newConsumer()\n        .subscriptionName(subscription);\n\n// Subscribe to all topics in a namespace\nPattern allTopicsInNamespace = Pattern.compile("persistent://public/default/.*");\nConsumer allTopicsConsumer = consumerBuilder\n        .topicsPattern(allTopicsInNamespace)\n        .subscribe();\n\n// Subscribe to a subsets of topics in a namespace, based on regex\nPattern someTopicsInNamespace = Pattern.compile("persistent://public/default/foo.*");\nConsumer allTopicsConsumer = consumerBuilder\n        .topicsPattern(someTopicsInNamespace)\n        .subscribe();\n\n')),(0,i.kt)("p",null,"You can also subscribe to an explicit list of topics (across namespaces if you wish):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nList<String> topics = Arrays.asList(\n        "topic-1",\n        "topic-2",\n        "topic-3"\n);\n\nConsumer multiTopicConsumer = consumerBuilder\n        .topics(topics)\n        .subscribe();\n\n// Alternatively:\nConsumer multiTopicConsumer = consumerBuilder\n        .topics(\n            "topic-1",\n            "topic-2",\n            "topic-3"\n        )\n        .subscribe();\n\n')),(0,i.kt)("p",null,"You can also subscribe to multiple topics asynchronously using the ",(0,i.kt)("inlineCode",{parentName:"p"},"subscribeAsync")," method rather than the synchronous ",(0,i.kt)("inlineCode",{parentName:"p"},"subscribe")," method. Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nPattern allTopicsInNamespace = Pattern.compile("persistent://public/default.*");\nconsumerBuilder\n        .topics(topics)\n        .subscribeAsync()\n        .thenAccept(this::receiveMessageFromConsumer);\n\nprivate void receiveMessageFromConsumer(Consumer consumer) {\n    consumer.receiveAsync().thenAccept(message -> {\n                // Do something with the received message\n                receiveMessageFromConsumer(consumer);\n            });\n}\n\n')),(0,i.kt)("h3",{id:"subscription-types"},"Subscription types"),(0,i.kt)("p",null,"Pulsar has various ",(0,i.kt)("a",{parentName:"p",href:"concepts-messaging#subscription-types"},"subscription types")," to match different scenarios. A topic can have multiple subscriptions with different subscription types. However, a subscription can only have one subscription type at a time."),(0,i.kt)("p",null,"A subscription is identified with the subscription name; a subscription name can specify only one subscription type at a time. To change the subscription type, you should first stop all consumers of this subscription."),(0,i.kt)("p",null,"Different subscription types have different message distribution modes. This section describes the differences of subscription types and how to use them."),(0,i.kt)("p",null,'In order to better describe their differences, assuming you have a topic named "my-topic", and the producer has published 10 messages.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> producer = client.newProducer(Schema.STRING)\n        .topic("my-topic")\n        .enableBatching(false)\n        .create();\n// 3 messages with "key-1", 3 messages with "key-2", 2 messages with "key-3" and 2 messages with "key-4"\nproducer.newMessage().key("key-1").value("message-1-1").send();\nproducer.newMessage().key("key-1").value("message-1-2").send();\nproducer.newMessage().key("key-1").value("message-1-3").send();\nproducer.newMessage().key("key-2").value("message-2-1").send();\nproducer.newMessage().key("key-2").value("message-2-2").send();\nproducer.newMessage().key("key-2").value("message-2-3").send();\nproducer.newMessage().key("key-3").value("message-3-1").send();\nproducer.newMessage().key("key-3").value("message-3-2").send();\nproducer.newMessage().key("key-4").value("message-4-1").send();\nproducer.newMessage().key("key-4").value("message-4-2").send();\n\n')),(0,i.kt)("h4",{id:"exclusive"},"Exclusive"),(0,i.kt)("p",null,"Create a new consumer and subscribe with the ",(0,i.kt)("inlineCode",{parentName:"p"},"Exclusive")," subscription type."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Exclusive)\n        .subscribe()\n\n')),(0,i.kt)("p",null,"Only the first consumer is allowed to the subscription, other consumers receive an error. The first consumer receives all 10 messages, and the consuming order is the same as the producing order."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If topic is a partitioned topic, the first consumer subscribes to all partitioned topics, other consumers are not assigned with partitions and receive an error. "))),(0,i.kt)("h4",{id:"failover"},"Failover"),(0,i.kt)("p",null,"Create new consumers and subscribe with the",(0,i.kt)("inlineCode",{parentName:"p"},"Failover")," subscription type."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Failover)\n        .subscribe()\nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Failover)\n        .subscribe()\n//conumser1 is the active consumer, consumer2 is the standby consumer.\n//consumer1 receives 5 messages and then crashes, consumer2 takes over as an  active consumer.\n\n')),(0,i.kt)("p",null,"Multiple consumers can attach to the same subscription, yet only the first consumer is active, and others are standby. When the active consumer is disconnected, messages will be dispatched to one of standby consumers, and the standby consumer becomes active consumer. "),(0,i.kt)("p",null,"If the first active consumer receives 5 messages and is disconnected, the standby consumer becomes active consumer. Consumer1 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-2")\n("key-1", "message-1-3")\n("key-2", "message-2-1")\n("key-2", "message-2-2")\n\n')),(0,i.kt)("p",null,"consumer2 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-2", "message-2-3")\n("key-3", "message-3-1")\n("key-3", "message-3-2")\n("key-4", "message-4-1")\n("key-4", "message-4-2")\n\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If a topic is a partitioned topic, each partition only has one active consumer, messages of one partition only distributed to one consumer, messages of multiple partitions are distributed to multiple consumers. "))),(0,i.kt)("h4",{id:"shared"},"Shared"),(0,i.kt)("p",null,"Create new consumers and subscribe with ",(0,i.kt)("inlineCode",{parentName:"p"},"Shared")," subscription type."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Shared)\n        .subscribe()\n  \nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Shared)\n        .subscribe()\n//Both consumer1 and consumer 2 is active consumers.\n\n')),(0,i.kt)("p",null,"In shared subscription type, multiple consumers can attach to the same subscription and message are delivered in a round robin distribution across consumers."),(0,i.kt)("p",null,"If a broker dispatches only one message at a time, consumer1 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-3")\n("key-2", "message-2-2")\n("key-3", "message-3-1")\n("key-4", "message-4-1")\n\n')),(0,i.kt)("p",null,"consumer 2 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-1", "message-1-2")\n("key-2", "message-2-1")\n("key-2", "message-2-3")\n("key-3", "message-3-2")\n("key-4", "message-4-2")\n\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Shared")," subscription is different from ",(0,i.kt)("inlineCode",{parentName:"p"},"Exclusive")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Failover")," subscription types. ",(0,i.kt)("inlineCode",{parentName:"p"},"Shared")," subscription has better flexibility, but cannot provide order guarantee."),(0,i.kt)("h4",{id:"key_shared"},"Key_Shared"),(0,i.kt)("p",null,"This is a new subscription type since 2.4.0 release, create new consumers and subscribe with ",(0,i.kt)("inlineCode",{parentName:"p"},"Key_Shared")," subscription type:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Key_Shared)\n        .subscribe()\n  \nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Key_Shared)\n        .subscribe()\n//Both consumer1 and consumer2 are active consumers.\n\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Key_Shared")," subscription is like ",(0,i.kt)("inlineCode",{parentName:"p"},"Shared")," subscription, all consumers can attach to the same subscription. But it is different from ",(0,i.kt)("inlineCode",{parentName:"p"},"Key_Shared")," subscription, messages with the same key are delivered to only one consumer in order. The possible distribution of messages between different consumers(by default we do not know in advance which keys will be assigned to a consumer, but a key will only be assigned to a consumer at the same time. ) ."),(0,i.kt)("p",null,"consumer1 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-2")\n("key-1", "message-1-3")\n("key-3", "message-3-1")\n("key-3", "message-3-2")\n\n')),(0,i.kt)("p",null,"consumer 2 will receive:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'\n("key-2", "message-2-1")\n("key-2", "message-2-2")\n("key-2", "message-2-3")\n("key-4", "message-4-1")\n("key-4", "message-4-2")\n\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If the message key is not specified, messages without key will be dispatched to one consumer in order by default."))),(0,i.kt)("h2",{id:"reader-interface"},"Reader interface"),(0,i.kt)("p",null,"With the ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/concepts-clients#reader-interface"},"reader interface"),', Pulsar clients can "manually position" themselves within a topic, reading all messages from a specified message onward. The Pulsar API for Java enables you to create  ',(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/Reader"},"Reader")," objects by specifying a topic and a ",(0,i.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/MessageId"},"MessageId"),"."),(0,i.kt)("p",null,"Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"\nbyte[] msgIdBytes = // Some message ID byte array\nMessageId id = MessageId.fromByteArray(msgIdBytes);\nReader reader = pulsarClient.newReader()\n        .topic(topic)\n        .startMessageId(id)\n        .create();\n\nwhile (true) {\n    Message message = reader.readNext();\n    // Process message\n}\n\n")),(0,i.kt)("p",null,"In the example above, a ",(0,i.kt)("inlineCode",{parentName:"p"},"Reader")," object is instantiated for a specific topic and message (by ID); the reader then iterates over each message in the topic after the message identified by ",(0,i.kt)("inlineCode",{parentName:"p"},"msgIdBytes")," (how that value is obtained depends on the application)."),(0,i.kt)("p",null,"The code sample above shows pointing the ",(0,i.kt)("inlineCode",{parentName:"p"},"Reader")," object to a specific message (by ID), but you can also use ",(0,i.kt)("inlineCode",{parentName:"p"},"MessageId.earliest")," to point to the earliest available message on the topic of ",(0,i.kt)("inlineCode",{parentName:"p"},"MessageId.latest")," to point to the most recent available message."),(0,i.kt)("h2",{id:"schemas"},"Schemas"),(0,i.kt)("p",null,'In Pulsar, all message data consists of byte arrays "under the hood." ',(0,i.kt)("a",{parentName:"p",href:"schema-get-started"},"Message schemas")," enable you to use other types of data when constructing and handling messages (from simple types like strings to more complex, application-specific types). If you construct, say, a ",(0,i.kt)("a",{parentName:"p",href:"#producers"},"producer")," without specifying a schema, then the producer can only produce messages of type ",(0,i.kt)("inlineCode",{parentName:"p"},"byte[]"),". Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"\nProducer<byte[]> producer = client.newProducer()\n        .topic(topic)\n        .create();\n\n")),(0,i.kt)("p",null,"The producer above is equivalent to a ",(0,i.kt)("inlineCode",{parentName:"p"},"Producer<byte[]>")," (in fact, you should ",(0,i.kt)("em",{parentName:"p"},"always")," explicitly specify the type). If you'd like to use a producer for a different type of data, you'll need to specify a ",(0,i.kt)("strong",{parentName:"p"},"schema")," that informs Pulsar which data type will be transmitted over the ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/reference-terminology#topic"},"topic"),"."),(0,i.kt)("h3",{id:"schema-example"},"Schema example"),(0,i.kt)("p",null,"Let's say that you have a ",(0,i.kt)("inlineCode",{parentName:"p"},"SensorReading")," class that you'd like to transmit over a Pulsar topic:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"\npublic class SensorReading {\n    public float temperature;\n\n    public SensorReading(float temperature) {\n        this.temperature = temperature;\n    }\n\n    // A no-arg constructor is required\n    public SensorReading() {\n    }\n\n    public float getTemperature() {\n        return temperature;\n    }\n\n    public void setTemperature(float temperature) {\n        this.temperature = temperature;\n    }\n}\n\n")),(0,i.kt)("p",null,"You could then create a ",(0,i.kt)("inlineCode",{parentName:"p"},"Producer<SensorReading>")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"Consumer<SensorReading>"),") like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<SensorReading> producer = client.newProducer(JSONSchema.of(SensorReading.class))\n        .topic("sensor-readings")\n        .create();\n\n')),(0,i.kt)("p",null,"The following schema formats are currently available for Java:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"No schema or the byte array schema (which can be applied using ",(0,i.kt)("inlineCode",{parentName:"p"},"Schema.BYTES"),"):"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> bytesProducer = client.newProducer(Schema.BYTES)\n    .topic("some-raw-bytes-topic")\n    .create();\n\n')),(0,i.kt)("p",{parentName:"li"},"Or, equivalently:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> bytesProducer = client.newProducer()\n    .topic("some-raw-bytes-topic")\n    .create();\n\n'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"String")," for normal UTF-8-encoded string data. This schema can be applied using ",(0,i.kt)("inlineCode",{parentName:"p"},"Schema.STRING"),":"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> stringProducer = client.newProducer(Schema.STRING)\n    .topic("some-string-topic")\n    .create();\n\n'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"JSON schemas can be created for POJOs using ",(0,i.kt)("inlineCode",{parentName:"p"},"Schema.JSON"),". Here's an example:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyPojo> pojoProducer = client.newProducer(Schema.JSON(MyPojo.class))\n    .topic("some-pojo-topic")\n    .create();\n\n'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Protobuf schemas can be generate using ",(0,i.kt)("inlineCode",{parentName:"p"},"Schema.PROTOBUF"),". The following example shows how to create the Protobuf schema and use it to instantiate a new producer:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyProtobuf> protobufProducer = client.newProducer(Schema.PROTOBUF(MyProtobuf.class))\n    .topic("some-protobuf-topic")\n    .create();\n\n'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Avro schemas can be defined with the help of ",(0,i.kt)("inlineCode",{parentName:"p"},"Schema.AVRO"),". The next code snippet demonstrates the creation and usage of the Avro schema:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyAvro> avroProducer = client.newProducer(Schema.AVRO(MyAvro.class))\n    .topic("some-avro-topic")\n    .create();\n\n')))),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"Pulsar currently supports two authentication schemes: ",(0,i.kt)("a",{parentName:"p",href:"/docs/2.4.1/security-tls-authentication"},"TLS")," and ",(0,i.kt)("a",{parentName:"p",href:"security-athenz"},"Athenz"),". The Pulsar Java client can be used with both."),(0,i.kt)("h3",{id:"tls-authentication"},"TLS Authentication"),(0,i.kt)("p",null,"To use ",(0,i.kt)("a",{parentName:"p",href:"security-tls-authentication"},"TLS"),", you need to set TLS to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," using the ",(0,i.kt)("inlineCode",{parentName:"p"},"setUseTls")," method, point your Pulsar client to a TLS cert path, and provide paths to cert and key files."),(0,i.kt)("p",null,"Here's an example configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nMap<String, String> authParams = new HashMap();\nauthParams.put("tlsCertFile", "/path/to/client-cert.pem");\nauthParams.put("tlsKeyFile", "/path/to/client-key.pem");\n\nAuthentication tlsAuth = AuthenticationFactory\n        .create(AuthenticationTls.class.getName(), authParams);\n\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar+ssl://my-broker.com:6651")\n        .enableTls(true)\n        .tlsTrustCertsFilePath("/path/to/cacert.pem")\n        .authentication(tlsAuth)\n        .build();\n\n')),(0,i.kt)("h3",{id:"athenz"},"Athenz"),(0,i.kt)("p",null,"To use ",(0,i.kt)("a",{parentName:"p",href:"security-athenz"},"Athenz")," as an authentication provider, you need to ",(0,i.kt)("a",{parentName:"p",href:"#tls-authentication"},"use TLS")," and provide values for four parameters in a hash:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tenantDomain")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tenantService")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"providerDomain")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"privateKey"))),(0,i.kt)("p",null,"You can also set an optional ",(0,i.kt)("inlineCode",{parentName:"p"},"keyId"),". Here's an example configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nMap<String, String> authParams = new HashMap();\nauthParams.put("tenantDomain", "shopping"); // Tenant domain name\nauthParams.put("tenantService", "some_app"); // Tenant service name\nauthParams.put("providerDomain", "pulsar"); // Provider domain name\nauthParams.put("privateKey", "file:///path/to/private.pem"); // Tenant private key path\nauthParams.put("keyId", "v1"); // Key id for the tenant private key (optional, default: "0")\n\nAuthentication athenzAuth = AuthenticationFactory\n        .create(AuthenticationAthenz.class.getName(), authParams);\n\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar+ssl://my-broker.com:6651")\n        .enableTls(true)\n        .tlsTrustCertsFilePath("/path/to/cacert.pem")\n        .authentication(athenzAuth)\n        .build();\n\n')),(0,i.kt)("blockquote",null,(0,i.kt)("h4",{parentName:"blockquote",id:"supported-pattern-formats"},"Supported pattern formats"),(0,i.kt)("p",{parentName:"blockquote"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"privateKey")," parameter supports the following three pattern formats:"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"file:///path/to/file")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"file:/path/to/file")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"data:application/x-pem-file;base64,<base64-encoded value>")))))}m.isMDXComponent=!0}}]);