<!doctype html>
<html class="docs-version-2.9.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Atom Feed"><title data-react-helmet="true">Using TLS with KeyStore configure | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/security-tls-keystore"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.9.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.9.1"><meta data-react-helmet="true" property="og:title" content="Using TLS with KeyStore configure | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/security-tls-keystore"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/security-tls-keystore" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/security-tls-keystore" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7e3a3d28.css">
<link rel="preload" href="/assets/js/runtime~main.64567627.js" as="script">
<link rel="preload" href="/assets/js/main.7befe8d6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a><a class="font-bold underline mr-4 -ml-4" href="/versions/">2.9.1</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/client-libraries">Clients</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a href="/admin-rest-api?version=2.9.1&amp;apiversion=v2" rel="noopener noreferrer" class="dropdown__link"><span>Admin REST API</span></a></li><li><a href="/functions-rest-api?version=2.9.1&amp;apiversion=v3" rel="noopener noreferrer" class="dropdown__link"><span>Functions</span></a></li><li><a href="/source-rest-api?version=2.9.1&amp;apiversion=v3" rel="noopener noreferrer" class="dropdown__link"><span>Sources</span></a></li><li><a href="/sink-rest-api?version=2.9.1&amp;apiversion=v3" rel="noopener noreferrer" class="dropdown__link"><span>Sinks</span></a></li><li><a href="/packages-rest-api?version=2.9.1&amp;apiversion=v3" rel="noopener noreferrer" class="dropdown__link"><span>Packages</span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a href="/pulsar-admin-cli?version=2.9.1" rel="noopener noreferrer" class="dropdown__link"><span>Pulsar Admin</span></a></li><li><a href="/pulsar-client-cli?version=2.9.1" rel="noopener noreferrer" class="dropdown__link"><span>Pulsar Client</span></a></li><li><a href="/pulsar-perf-cli?version=2.9.1" rel="noopener noreferrer" class="dropdown__link"><span>Pulsar Perf</span></a></li><li><a href="/pulsar-cli?version=2.9.1" rel="noopener noreferrer" class="dropdown__link"><span>Pulsar</span></a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contact">Contact</a></li><li><a class="dropdown__link" href="/contributing">Contributing</a></li><li><a class="dropdown__link" href="/coding-guide">Coding guide</a></li><li><a class="dropdown__link" href="/events">Events</a></li><li><a href="https://twitter.com/Apache_Pulsar" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Issue tracking<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://pulsar-summit.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Pulsar Summit<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/resources">Resources</a></li><li><a class="dropdown__link" href="/team">Team</a></li><li><a class="dropdown__link" href="/powered-by">Powered By</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Thanks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts-overview">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/schema-get-started">Pulsar Schema</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/functions-overview">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/io-overview">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/sql-overview">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/tiered-storage-overview">Tiered Storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/txn-why">Transactions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/helm-overview">Kubernetes (Helm)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/deploy-aws">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/administration-zk-bk">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/security-overview">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-tls-transport">Transport Encryption using TLS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-tls-authentication">Authentication using TLS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-jwt">Authentication using JWT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-athenz">Authentication using Athenz</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-kerberos">Authentication using Kerberos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-oauth2">Authentication using OAuth 2.0 access tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-authorization">Authorization and ACLs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-encryption">End-to-End Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-extending">Extending</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/performance-pulsar-perf">Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/client-libraries">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/admin-api-overview">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/adaptors-kafka">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cookbooks-compaction">Cookbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/develop-tools">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/reference-terminology">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.9.1</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Using TLS with KeyStore configure</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">â€‹</a></h2><p>Apache Pulsar supports <a href="/docs/security-tls-transport">TLS encryption</a> and <a href="/docs/security-tls-authentication">TLS authentication</a> between clients and Apache Pulsar service.
By default it uses PEM format file configuration. This page tries to describe use <a href="https://en.wikipedia.org/wiki/Java_KeyStore" target="_blank" rel="noopener noreferrer">KeyStore</a> type configure for TLS.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tls-encryption-with-keystore-configure">TLS encryption with KeyStore configure<a class="hash-link" href="#tls-encryption-with-keystore-configure" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="generate-tls-key-and-certificate">Generate TLS key and certificate<a class="hash-link" href="#generate-tls-key-and-certificate" title="Direct link to heading">â€‹</a></h3><p>The first step of deploying TLS is to generate the key and the certificate for each machine in the cluster.
You can use Javaâ€™s <code>keytool</code> utility to accomplish this task. We will generate the key into a temporary keystore
initially for broker, so that we can export and sign it later with CA.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore broker.keystore.jks -alias localhost -validity </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">validity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> -genkeypair -keyalg RSA</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You need to specify two parameters in the above command:</p><ol><li><code>keystore</code>: the keystore file that stores the certificate. The <em>keystore</em> file contains the private key of
the certificate; hence, it needs to be kept safely.</li><li><code>validity</code>: the valid time of the certificate in days.</li></ol><blockquote><p>Ensure that common name (CN) matches exactly with the fully qualified domain name (FQDN) of the server.
The client compares the CN with the DNS domain name to ensure that it is indeed connecting to the desired server, not a malicious one.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_y2LR" id="creating-your-own-ca">Creating your own CA<a class="hash-link" href="#creating-your-own-ca" title="Direct link to heading">â€‹</a></h3><p>After the first step, each broker in the cluster has a public-private key pair, and a certificate to identify the machine.
The certificate, however, is unsigned, which means that an attacker can create such a certificate to pretend to be any machine.</p><p>Therefore, it is important to prevent forged certificates by signing them for each machine in the cluster.
A <code>certificate authority (CA)</code> is responsible for signing certificates. CA works likes a government that issues passports â€”
the government stamps (signs) each passport so that the passport becomes difficult to forge. Other governments verify the stamps
to ensure the passport is authentic. Similarly, the CA signs the certificates, and the cryptography guarantees that a signed
certificate is computationally difficult to forge. Thus, as long as the CA is a genuine and trusted authority, the clients have
high assurance that they are connecting to the authentic machines.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl req -new -x509 -keyout ca-key -out ca-cert -days </span><span class="token number">365</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The generated CA is simply a <em>public-private</em> key pair and certificate, and it is intended to sign other certificates.</p><p>The next step is to add the generated CA to the clients&#x27; truststore so that the clients can trust this CA:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore client.truststore.jks -alias CARoot -import -file ca-cert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>NOTE: If you configure the brokers to require client authentication by setting <code>tlsRequireTrustedClientCertOnConnect</code> to <code>true</code> on the
broker configuration, then you must also provide a truststore for the brokers and it should have all the CA certificates that clients keys were signed by.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore broker.truststore.jks -alias CARoot -import -file ca-cert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In contrast to the keystore, which stores each machineâ€™s own identity, the truststore of a client stores all the certificates
that the client should trust. Importing a certificate into oneâ€™s truststore also means trusting all certificates that are signed
by that certificate. As the analogy above, trusting the government (CA) also means trusting all passports (certificates) that
it has issued. This attribute is called the chain of trust, and it is particularly useful when deploying TLS on a large BookKeeper cluster.
You can sign all certificates in the cluster with a single CA, and have all machines share the same truststore that trusts the CA.
That way all machines can authenticate all other machines.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="signing-the-certificate">Signing the certificate<a class="hash-link" href="#signing-the-certificate" title="Direct link to heading">â€‹</a></h3><p>The next step is to sign all certificates in the keystore with the CA we generated. First, you need to export the certificate from the keystore:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore broker.keystore.jks -alias localhost -certreq -file cert-file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then sign it with the CA:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl x509 -req -CA ca-cert -CAkey ca-key -in cert-file -out cert-signed -days </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">validity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> -CAcreateserial -passin pass:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">ca-password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Finally, you need to import both the certificate of the CA and the signed certificate into the keystore:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore broker.keystore.jks -alias CARoot -import -file ca-cert</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">keytool -keystore broker.keystore.jks -alias localhost -import -file cert-signed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The definitions of the parameters are the following:</p><ol><li><code>keystore</code>: the location of the keystore</li><li><code>ca-cert</code>: the certificate of the CA</li><li><code>ca-key</code>: the private key of the CA</li><li><code>ca-password</code>: the passphrase of the CA</li><li><code>cert-file</code>: the exported, unsigned certificate of the broker</li><li><code>cert-signed</code>: the signed certificate of the broker</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-brokers">Configuring brokers<a class="hash-link" href="#configuring-brokers" title="Direct link to heading">â€‹</a></h3><p>Brokers enable TLS by provide valid <code>brokerServicePortTls</code> and <code>webServicePortTls</code>, and also need set <code>tlsEnabledWithKeyStore</code> to <code>true</code> for using KeyStore type configuration.
Besides this, KeyStore path,  KeyStore password, TrustStore path, and TrustStore password need to provided.
And since broker will create internal client/admin client to communicate with other brokers, user also need to provide config for them, this is similar to how user config the outside client/admin-client.
If <code>tlsRequireTrustedClientCertOnConnect</code> is <code>true</code>, broker will reject the Connection if the Client Certificate is not trusted. </p><p>The following TLS configs are needed on the broker side:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsEnabledWithKeyStore=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># key store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStore=/var/private/tls/broker.keystore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStorePassword=brokerpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># trust store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStore=/var/private/tls/broker.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePassword=brokerpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># internal client/admin-client config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabledWithKeyStore=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStore=/var/private/tls/client.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStorePassword=clientpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>NOTE: it is important to restrict access to the store files via filesystem permissions.</p><p>If you have configured TLS on the broker, to disable non-TLS ports, you can set the values of the following configurations to empty as below.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerServicePort=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webServicePort=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this case, you need to set the following configurations.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabled=true // Set this to true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabledWithKeyStore=true  // Set this to true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStore= // Set this to your desired value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStorePassword= // Set this to your desired value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Optional settings that may worth consider:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. tlsClientAuthentication=false: Enable/Disable using TLS for authentication. This config when enabled will authenticate the other end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   of the communication channel. It should be enabled on both brokers and clients for mutual TLS.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. tlsCiphers=[TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256], A cipher suite is a named combination of authentication, encryption, MAC and key exchange</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   algorithm used to negotiate the security settings for a network connection using TLS network protocol. By default,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   it is null. [OpenSSL Ciphers](https://www.openssl.org/docs/man1.0.2/apps/ciphers.html)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   [JDK Ciphers](http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#ciphersuites)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. tlsProtocols=[TLSv1.3,TLSv1.2] (list out the TLS protocols that you are going to accept from clients).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   By default, it is not set.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-clients">Configuring Clients<a class="hash-link" href="#configuring-clients" title="Direct link to heading">â€‹</a></h3><p>This is similar to <!-- -->[TLS encryption configuing for client with PEM type]<!-- -->(/docs/security-tls-transport#Client configuration).
For a a minimal configuration, user need to provide the TrustStore information.</p><p>e.g. </p><ol><li><p>for <a href="/docs/reference-cli-tools">Command-line tools</a> like <a href="/docs/reference-cli-tools#pulsar-admin"><code>pulsar-admin</code></a>, <a href="/docs/reference-cli-tools#pulsar-perf"><code>pulsar-perf</code></a>, and <a href="/docs/reference-cli-tools#pulsar-client"><code>pulsar-client</code></a> use the <code>conf/client.conf</code> config file in a Pulsar installation.</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webServiceUrl=https://broker.example.com:8443/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerServiceUrl=pulsar+ssl://broker.example.com:6651/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">useKeyStoreTls=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePath=/var/private/tls/client.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePassword=clientpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>for java client</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.client.api.PulsarClient;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient client = PulsarClient.builder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .serviceUrl(&quot;pulsar+ssl://broker.example.com:6651/&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .enableTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .useKeyStoreTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .tlsTrustStorePath(&quot;/var/private/tls/client.truststore.jks&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .tlsTrustStorePassword(&quot;clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .allowTlsInsecureConnection(false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>for java admin client</p></li></ol><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PulsarAdmin amdin = PulsarAdmin.builder().serviceHttpUrl(&quot;https://broker.example.com:8443&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .useKeyStoreTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .tlsTrustStorePath(&quot;/var/private/tls/client.truststore.jks&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .tlsTrustStorePassword(&quot;clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .allowTlsInsecureConnection(false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tls-authentication-with-keystore-configure">TLS authentication with KeyStore configure<a class="hash-link" href="#tls-authentication-with-keystore-configure" title="Direct link to heading">â€‹</a></h2><p>This similar to <a href="/docs/security-tls-authentication">TLS authentication with PEM type</a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="broker-authentication-config">broker authentication config<a class="hash-link" href="#broker-authentication-config" title="Direct link to heading">â€‹</a></h3><p><code>broker.conf</code></p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Configuration to enable authentication</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderTls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># this should be the CN for one of client keystore.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">superUserRoles=admin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Enable KeyStore type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsEnabledWithKeyStore=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">requireTrustedClientCertOnConnect=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># key store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStore=/var/private/tls/broker.keystore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsKeyStorePassword=brokerpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># trust store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStore=/var/private/tls/broker.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePassword=brokerpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># internal client/admin-client config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsEnabledWithKeyStore=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStore=/var/private/tls/client.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientTlsTrustStorePassword=clientpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># internal auth config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientAuthenticationPlugin=org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientAuthenticationParameters={&quot;keyStoreType&quot;:&quot;JKS&quot;,&quot;keyStorePath&quot;:&quot;/var/private/tls/client.keystore.jks&quot;,&quot;keyStorePassword&quot;:&quot;clientpw&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># currently websocket not support keystore type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webSocketServiceEnabled=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="client-authentication-configuring">client authentication configuring<a class="hash-link" href="#client-authentication-configuring" title="Direct link to heading">â€‹</a></h3><p>Besides the TLS encryption configuring. The main work is configuring the KeyStore, which contains a valid CN as client role, for client.</p><p>e.g. </p><ol><li><p>for <a href="/docs/reference-cli-tools">Command-line tools</a> like <a href="/docs/reference-cli-tools#pulsar-admin"><code>pulsar-admin</code></a>, <a href="/docs/reference-cli-tools#pulsar-perf"><code>pulsar-perf</code></a>, and <a href="/docs/reference-cli-tools#pulsar-client"><code>pulsar-client</code></a> use the <code>conf/client.conf</code> config file in a Pulsar installation.</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">webServiceUrl=https://broker.example.com:8443/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerServiceUrl=pulsar+ssl://broker.example.com:6651/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">useKeyStoreTls=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStoreType=JKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePath=/var/private/tls/client.truststore.jks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tlsTrustStorePassword=clientpw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authPlugin=org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authParams={&quot;keyStoreType&quot;:&quot;JKS&quot;,&quot;keyStorePath&quot;:&quot;/path/to/keystorefile&quot;,&quot;keyStorePassword&quot;:&quot;keystorepw&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>for java client</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.client.api.PulsarClient;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient client = PulsarClient.builder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .serviceUrl(&quot;pulsar+ssl://broker.example.com:6651/&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .enableTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .useKeyStoreTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .tlsTrustStorePath(&quot;/var/private/tls/client.truststore.jks&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .tlsTrustStorePassword(&quot;clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .allowTlsInsecureConnection(false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .authentication(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;keyStoreType:JKS,keyStorePath:/var/private/tls/client.keystore.jks,keyStorePassword:clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>for java admin client</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PulsarAdmin amdin = PulsarAdmin.builder().serviceHttpUrl(&quot;https://broker.example.com:8443&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .useKeyStoreTls(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .tlsTrustStorePath(&quot;/var/private/tls/client.truststore.jks&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .tlsTrustStorePassword(&quot;clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .allowTlsInsecureConnection(false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .authentication(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               &quot;org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">               &quot;keyStoreType:JKS,keyStorePath:/var/private/tls/client.keystore.jks,keyStorePassword:clientpw&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="enabling-tls-logging">Enabling TLS Logging<a class="hash-link" href="#enabling-tls-logging" title="Direct link to heading">â€‹</a></h2><p>You can enable TLS debug logging at the JVM level by starting the brokers and/or clients with <code>javax.net.debug</code> system property. For example:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Djavax.net.debug</span><span class="token operator">=</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can find more details on this in <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html" target="_blank" rel="noopener noreferrer">Oracle documentation</a> on <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html" target="_blank" rel="noopener noreferrer">debugging SSL/TLS connections</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.9.1/security-tls-keystore.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/security-tls-authentication"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Authentication using TLS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/security-jwt"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Authentication using JWT</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#tls-encryption-with-keystore-configure" class="table-of-contents__link toc-highlight">TLS encryption with KeyStore configure</a><ul><li><a href="#generate-tls-key-and-certificate" class="table-of-contents__link toc-highlight">Generate TLS key and certificate</a></li><li><a href="#creating-your-own-ca" class="table-of-contents__link toc-highlight">Creating your own CA</a></li><li><a href="#signing-the-certificate" class="table-of-contents__link toc-highlight">Signing the certificate</a></li><li><a href="#configuring-brokers" class="table-of-contents__link toc-highlight">Configuring brokers</a></li><li><a href="#configuring-clients" class="table-of-contents__link toc-highlight">Configuring Clients</a></li></ul></li><li><a href="#tls-authentication-with-keystore-configure" class="table-of-contents__link toc-highlight">TLS authentication with KeyStore configure</a><ul><li><a href="#broker-authentication-config" class="table-of-contents__link toc-highlight">broker authentication config</a></li><li><a href="#client-authentication-configuring" class="table-of-contents__link toc-highlight">client authentication configuring</a></li></ul></li><li><a href="#enabling-tls-logging" class="table-of-contents__link toc-highlight">Enabling TLS Logging</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.64567627.js"></script>
<script src="/assets/js/main.7befe8d6.js"></script>
</body>
</html>